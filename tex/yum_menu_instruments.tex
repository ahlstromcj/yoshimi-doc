%-------------------------------------------------------------------------------
% yum_menu_instruments
%-------------------------------------------------------------------------------
%
% \file        yum_menu_instruments.tex
% \library     Documents
% \author      Chris Ahlstrom
% \date        2016-02-27
% \update      2018-12-29
% \version     $Revision$
% \license     $XPC_GPL_LICENSE$
%
%     Provides the Menu / Instruments section of the manual.
%
%-------------------------------------------------------------------------------

\subsection{Menu / Instruments}
\label{subsec:menu_instrument}

   The \textsl{Yoshimi} Instruments menu lets one select instruments and work
   with banks of instruments.

   While the \textbf{Instrument Menu} allows for the management of parts, the
   \textbf{Part Edit} dialog, described in
   \sectionref{subsec:bottom_panel_instrument_edit},
   is where one would start for the the creation of a new part/instrument.

   When opening an instrument bank one can now tell exactly which synth engines
   are used by each instrument. This is represented by three pale background
   colours:

   \begin{itemize}
      \item \textbf{\textcolor{red}{Red}}: ADDsynth
      \item \textbf{\textcolor{blue}{Blue}}: SUBsynth
      \item \textbf{\textcolor{green}{Green}}: PADsynth
   \end{itemize}

   These new coloured engine backgrounds aren't just pretty. They give real
   information about expected processor load, and time taken to be ready when
   loaded:

   \begin{itemize}
      \item Processor Load, low to high:
         \textbf{\textcolor{green}{PAD}},
         \textbf{\textcolor{blue}{SUB}}, then
         \textbf{\textcolor{red}{ADD}}.
      \item Time to initialise, low to high:
         \textbf{\textcolor{blue}{SUB}},
         \textbf{\textcolor{red}{ADD}},
         \textbf{\textcolor{green}{PAD}}.
   \end{itemize}

   If the instruments are kits they are scanned to find out if
   \textsl{any} member of the kit contains each engine.
   This scanning is duplicated in the current part, the mixer panel for the
   currently loaded instruments, and in the Instrument Edit window the same
   colours highlight the engine names when they are enabled with the check
   boxes.

   The following sub-menus are provided, as shown in
   \figureref{fig:yoshimi_instrument_menu}.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.9]{1.6.0/menu_instrument.png}
   \caption{Yoshimi Menu, Instruments}
   \label{fig:yoshimi_instrument_menu}
\end{figure}

   This new version of the \textbf{Instruments}
   menu is somewhat different than
   the old version.  It is actually simpler and easier to use, while still
   offering all of the power of the setting up of instruments in
   \textsl{Yoshimi}.

   \begin{enumber}
      \item \textbf{Show Stored...}
      \item \textbf{Load External...}
      \item \textbf{Save External...}
      \item \textbf{Recent Instruments...}
      \item \textbf{Clear}
      \item \textbf{Search}
   \end{enumber}

%  \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

\subsubsection{Menu / Instrument / Show Stored...}
\label{subsubsec:menu_instrument_show}

   Instruments are stored in banks
   (see \sectionref{subsec:concepts_banks_and_roots}).
   The banks (and current bank setting) are
   loaded/saved automatically by the program, so one doesn't have to worry
   about saving the banks before the program exits. On program start, the last
   used bank is loaded. A single bank can store up to 128 instruments.
   However, there is space for a number of additional instruments in the bank,
   the extended-program section, to allow up to 160 instruments in a bank.

   When the \textbf{Show Stored...} button is selected, a dialog comes
   up that shows all of the instruments present in the currently-selected
   bank.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{2.3.0/instruments.png}
   \caption[Show Stored Instruments]{Instruments Stored in Current Banks}
   \label{fig:instruments_show_stored}
\end{figure}

   As \figureref{fig:instruments_show_stored},
   shows, this is a very complex dialog with a lot of options.
   The figure shows a default setup, with the bank of instruments at location
   30, \textbf{30. Cormi Sound}, listed.
   If one drops this list down (shown later), one also observes that the banks
   are numbered in increments of 5, to make it easier for a user to insert his
   or her own bank(s) of instruments. The default set of banks are spaced 5
   apart for this reason. If we add more than 25 banks in future versions of
   \textsl{Yoshimi}, then a \textsl{clean} install will wrap round starting with
   location 2 and again spaced 5 apart, and so-on until all spaces are filled.
   For an existing setup, new entries will just be slotted in where they
   will fit.

   Also, if one deletes banks or instruments by some external means, the next
   time \textsl{Yoshimi} starts, it will notice their absence and quietly
   remove their entries.

   Note how \textsl{Yoshimi} shows the colour coding for the
   synth-sections used in each instrument:
   red for ADDsynth, blue for SUBsynth, and green for PADsynth.
   This used to be switchable as not fetching the colour information from the
   banks meant startup was sometimes slightly faster. However this then
   interfered with later developments that use this information for other
   purposes so it has now been removed.

   Also note how the numbers at the beginning of the filenames are used as
   an "instrument" or "program" number.  These numbers can be used in MIDI
   Program Change commands.

\index{new!Instrument Highlight}
   A new feature since \textsl{Yoshimi} V 1.7.2 is highlighting the last
   instrument seen. In this case, the third one in the list. This is
   particularly useful for banks where the internal name is different from the
   filename.

   All of the instrument files (such as \texttt{0001-Arpeggio1.xiz})
   with filenames starting with numbers (no matter how many digits)
   will be shown in the corresponding slot number.
   Variations in filename after the number are ignored; the files
   are treated as the same instrument.

   Those instrument files
   without numbers (or larger numbers?) will start
   with numbers at 129 or above ("Extended Program Change") up to 160.
   One could give them numbers by renaming them outside of \textsl{Yoshimi},
   then reloading the bank.
   One can also fix unnumbered ones simply by loading them, then re-saving them
   to the same slot. It's then probably best to swap them into the main set,
   if there is space.

   \index{extended program}
   Note that MIDI CC
   (see \sectionref{paragraph:menu_yoshimi_settings_ccs})
   can be set to access voices from 129 to 160.
   All the Bank controls in the \textbf{MIDI} settings tab take immediate
   effect when set.
   Bank and program changes can be completely disabled in the settings tab;
   some hardware synths don't play nice with it.

   Learning how to use the Instruments dialog is an important way to make
   instruments easier to manage, and so this will be a long discussion.

%  An important pair of concepts in \textsl{Yoshimi} are
%  \textsl{banks} and \textsl{roots}.  These concepts are described in
%  \sectionref{subsec:concepts_banks_and_roots}.

   Here is a list of the user-interface items in the instruments/banks dialog:

   \begin{enumber}
      \item \textbf{Bank Names}
      \item \textbf{Search}
      \item \textbf{Roots}
      \item \textbf{Banks}
      \item \textbf{Instrument and Bank Matrix}
      \item \textbf{SELECT}
      \item \textbf{RENAME}
      \item \textbf{SAVE}
      \item \textbf{DELETE}
      \item \textbf{SWAP}
%      \item \textbf{Show synth engines}
      \item \textbf{Close}
   \end{enumber}

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

   \itempar{Bank Names}{instruments!bank names}
   Instruments Bank Name.
   This item is a drop-down list of the available instrument banks in the
   currently-selected \textbf{root} directory.
   Basically, each bank is a directory name, with a number prepended.
   The banks are found under the current root, which is a also a directory
   name, and is the name of the parent directory of a set of banks.
   Here is the Bank Names drop-down list for the default setup, which has the
   default banks provided by the basic \textsl{Yoshimi} installation.

\begin{figure}[H]
   \centering
%  \includegraphics[scale=0.75]{menu/Instrument/bank-list.jpg}
   \includegraphics[scale=0.75]{2.3.0/banks.png}
   \caption[A Sample Bank List]{A Sample Bank List}
   \label{fig:bank_list}
\end{figure}

   And here is the directory listing associated with it, in the order
   produced by the UNIX/Linux \texttt{ls -1}
   (list single-column) command (shown in
   two columns to save space):

   \begin{verbatim}
      Arpeggios          Plucked
      Bass               Reed_and_Wind
      Brass              Rhodes
      Choir_and_Voice    Splited
      Drums              Strings
      Dual               Synth
      Fantasy            SynthPiano
      Guitar             The_Mysterious_Bank
      Misc               Will_Godfrey_Collection
      Noises             Will_Godfrey_Companion
      Organ              chip
      Pads               Cormi_Sound
   \end{verbatim}

   The directories (banks) shown above come from the default \textbf{root}
   when \textsl{Yoshimi} and its data files are installed:

   \begin{verbatim}
      /usr/share/yoshimi/banks
   \end{verbatim}

   If one installed \textsl{Yoshimi} by building the source code, then
   this directory is:

   \begin{verbatim}
      /usr/local/share/yoshimi/banks
   \end{verbatim}

   Note that the directory that holds the banks is shown in the title bar.
   Another good source of banks, if one installs \textsl{ZynAddSubFX}, is:

   \begin{verbatim}
      /usr/share/zynaddsubfx/banks
   \end{verbatim}

   Note that there are only 128 \textsl{Yoshimi} banks
   supported in a \textsl{Yoshimi} root.
   If the list of banks takes up about half of the available slots, it might be
   time to move some of those banks to a new root directory.

   The numbers in the drop-down list are generated by \textsl{Yoshimi} the
   first time it sees a new root path or a new bank within the root path.
   Once set, these numbers will never change unless one actually moves them
   around (using the \textbf{SWAP} button).

   The bank number is also the MIDI ID for the bank;
   one can be sure that it will always
   be there for bank changes, no matter how many banks are added later.
   \textsl{Yoshimi} always lists the banks in ID order, not alphabetical
   order, so one can group them sensibly and permanently.
   However, at first-time creation \textsl{Yoshimi} sets the IDs in
   alphabetical order and tries to space them evenly over the range to
   provide some wiggle room.
   Selecting one of the items in this drop-down list selects the bank and
   loads it into the Banks dialog.

   \index{anti-auto-clutter}
   Right-clicking or left-clicking on a bank in the drop-down list
   causes the instrument list of the previous bank to be replaced by the
   instrument list of the newly-selected bank.

   \index{new!instruments search}
   \itempar{Search}{instruments!search}
   Instruments Search Button.
   This feature arrived with \textsl{Yoshimi} V 1.6.0 and provides a
   way of finding instruments of a given type right across all known banks and
   bank roots.


\begin{figure}[H]
   \centering
%  \includegraphics[scale=0.75]{menu/Instrument/bank-list.jpg}
   \includegraphics[scale=0.5]{2.3.0/search.png}
   \caption[A search list List]{A search list}
   \label{fig:bank_search}
\end{figure}
   The top field is a drop-down menu that gives all the types
   \textsl{Yoshimi} recognises, and below this is the list of those
   most recently found. As well as the names of the instruments
   one sees the bank root ID, bank ID and instrument number. All of these
   are the values that will be recognised by MIDI.

   Clicking on any entry will immediately load the instrument into the
   current part \textbf{without} changing the settings for current bank or
   root.

   \itempar{Roots}{instruments!roots}
   Instruments Roots Button.
   Shows a list of directories that can serve as "root" directories.
   The "Bank Root Paths" dialog discussed in
   \sectionref{subsubsec:menu_patch_sets_patch_bank_roots}\hspace{4pt}in
   \figureref{fig:show_patch_banks}\hspace{4pt}shows
   the system root (e.g. \texttt{/usr/share/yoshimi/banks}) and
   a user's home location for his/her banks and roots.

   \itempar{Banks}{instruments!banks}
   Banks Button.
   This item brings up a Banks dialog showing all of the banks present in the
   current root.
   It is an alternative to using the \textbf{Bank Names} drop-down list to
   select a bank.  It is also a way to reorganise and renumber the
   banks without using the Linux console or a file-explorer application to do
   so.

   \itempar{Instrument and Bank Matrix}{instruments!bank matrix}
   Instruments Bank Matrix.
   Shows the instruments that are in the currently selected bank.

   The next few items are selector buttons that determine what happens when one
   clicks on an instrument name.

   \itempar{SELECT}{instruments!SELECT}
   Instruments SELECT.
   When this button is selected, then clicking on an instrument selects that
   instrument as the instrument for the current Part active in the main
   window.  In the main window of \textsl{Yoshimi}, that instrument name will
   appear in the currently-selected \textbf{Part}.  If \textsl{Yoshimi} is
   writing to a console window then each part, when clicked, will be shown:

   \begin{verbatim}
		yoshimi> Loaded 64 "Hyper Organ1" to Part 1
		Loaded 65 "Hyper Arpeggio" to Part 1
		Loaded 10 "Arpeggio11" to Part 1
		Loaded 41 "Soft Arpeggio4" to Part 1
		Loaded 67 "Glass Arpeggio1" to Part 1
   \end{verbatim}

   \itempar{RENAME}{instruments!RENAME}
   Instruments RENAME.
   When this button is selected, then clicking on a bank brings
   up a small dialog to rename the clicked-on bank.
   However, one will see the following warning message if trying to rename a
   file that is in a directory not modifiable by normal users:

   \begin{verbatim}
      ! Could not rename instrument 39 to Soft Arpeggio5 [Close]
   \end{verbatim}

   Note that, as soon as this operation is done, the auto-selector (green
   check-box) moves back to the \textbf{SELECT} button.

   \itempar{SAVE}{instruments!SAVE}
   Instruments SAVE.
   When this button is selected, then clicking on a bank saves
   the instruments as currently configured.
   A prompt like the following will appear:

   \begin{verbatim}
      ? Overwrite the slot no. 43 ?  [No/Yes]
   \end{verbatim}

   However, if one answers yes, and the instrument is in a non-modifiable
   directory, then one will see the following error message:

   \begin{verbatim}
      ! Could not save to this location [Close]
   \end{verbatim}

   \itempar{DELETE}{instruments!DELETE}
   Instruments DELETE.
   Selecting this button and clicking an empty bank entry does nothing.
   Selecting this button and clicking an existing bank entry brings up a
   small dialog asking one if this instrument is really to be deleted from
   the bank.

   \begin{verbatim}
      ? Clear the slot no. 68?  [No/Yes]
   \end{verbatim}

   However, if one answers yes, and the instrument is in a non-modifiable
   directory, then one will see the following error message:

   \begin{verbatim}
      ! Could not clear this location  [Close]
   \end{verbatim}

   \itempar{SWAP}{instruments!SWAP}
   Instruments SWAP.
   Selecting this button, then selecting one instrument, and then another,
   swaps the numbering and position of the selected instruments.
   However, one might also experience the following warning message:

   \begin{verbatim}
      ! Could not swap these locations  [Close]
   \end{verbatim}

   Note that all of the above error messages are also shown in the console, if
   it is where \textsl{Yoshimi} is running.  For example:

   \begin{verbatim}
      40 Failed to remove /usr/local/share/yoshimi/banks/Arpeggios/0041-Soft
      Arpeggio3.xiz Permission denied
   \end{verbatim}

   \itempar{Close}{instruments!Close}
   Closes the window.

\subsubsection{Menu / Instrument / Load External...}
\label{subsubsec:menu_instrument_load}

   This menu entry simply brings up a file dialog, allowing the user to
   navigate to an arbitrary directory, and then to a solitary instrument file
   (\texttt{*.xiz}), and load it into the current Part.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.5]{2.3.0/filer.png}
   \caption{Instruments, Load External}
   \label{fig:instruments_load_external}
\end{figure}

   These "xiz" files are normally found in a \texttt{banks} directory, but
   this operation allows access to instruments that are not located in a bank.

   \begin{itemize}
      \item If loading an external instrument file with no internal name,
         the file leafname will be shown.
      \item If loading an external instrument file with the name
         \textsl{Simple Sound}, the name \textsl{No Title} will be given.
      \item If loading a patch set that has unnamed instruments, or ones with
         the name \textsl{Simple Sound}, those will be given the name \textsl{No
         Title}.
   \end{itemize}

   This dialog has a number of user-interface elements to discuss:

   For further details see \sectionref{subsec:interface_filer}.


\subsubsection{Menu / Instrument / Save External...}
\label{subsubsec:menu_instrument_save}

   This menu entry simply brings up a file dialog, allowing the user to
   navigate to an arbitrary directory, and then save the current Part
   to a solitary instrument file (\texttt{*.xiz}).

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{2.3.0/save_ext_instrument.png}
   \caption{Instruments, Save External}
   \label{fig:instruments_save_external}
\end{figure}

   This dialog is very similar to the \textbf{Load External} dialog.
%   Note the large question mark in the XML preview, indicating a compressed XML
%   file.  If uncompressed, then an XML text preview will be shown.

   The instrument save action saves only what is essential to the instrument,
   and not the part it may be sitting in.  If there have been no changes in the
   instrument, then a \textbf{Nothing to save!} dialog appears.

   From \textsl{Yoshimi} V1.7.4 there is a warning if the 'type' filed has
   not been filled in. One can ignore this and save regardless, but it is
   hoped the gentle reminder will encourage more people to fill it in.

\subsubsection{Menu / Instrument / Recent Instruments...}
\label{subsubsec:menu_instrument_recent}

   This menu brings up a simple window with a list of the most recent
   instruments that have been selected.  A single-click on the desired
   instrument will load it.

\subsubsection{Menu / Instrument / Clear}
\label{subsubsec:menu_instrument_clear}

   Normally this menu entry simply clears the instrument that is loaded into
   the current Part.  This converts the instrument to a
   \textsl{Simple Sound} patch.
   However, if the Ctrl key is held down when clicking on the entry, the entire
   part will be returned to default values, including Controllers etc.

   In either case, the menu entry brings up a prompt with details of exactly what
   will be cleared.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{2.3.0/clear_instrument.png}
   \caption{Clear Instrument Dialog}
   \label{fig:clear_instrument_dialog}
\end{figure}
\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{2.3.0/clear_part.png}
   \caption{Clear Part Dialog}
   \label{fig:clear_part_dialog}
\end{figure}

   \textbf{No} is the default action.

\subsubsection{Menu / Instrument / Search}
\label{subsubsec:menu_instrument_search}

   This entry provides a quicker route to the instrument search feature described
   in \sectionref{subsubsec:menu_instrument_show}
\subsubsection{Menu / Instrument / Misc Notes}
\label{subsubsec:menu_instrument_misc_notes}

   There are still many instruments out there with
   no internal title. This fact applies to both external files and instruments
   in banks, and means that, once loaded, one does not know what instruments
   one has. So now, if the internal name is missing, \textsl{Yoshimi} will use
   the leaf-name of the file.  When one saves an instrument to a bank slot, it
   will get a filename with the internal name as the leaf-name.  When saving
   an instrument to an external file, the first offered will be the internal
   name and in the current directory, but this can be changed if desired.

   The part and mixer name fields will always show the (possibly adjusted)
   internal name regardless of the external filename, which could easily have
   been changed at some time.  The instrument banks will always show the file's
   leaf-name, so it more-or-less matches external files (what one sees from a
   file display).  As soon as one edits an instrument, if it was \textsl{Simple
   Sound}, the name will be changed to \textsl{No Title}.  \textsl{Yoshimi}
   generally won't let one rename an instrument to \textsl{Simple Sound}.

   Default instruments are never saved, not even in patch sets and states, but
   if the parts are activated, that fact \textsl{is} saved; it's a part
   feature, not an instrument one.

   Patch sets will save all other instruments regardless of whether they are
   activated or not.

   While testing all these features, Will created a new multi-part instrument
   kit.  It's now in the \textsl{Companion} set and is called \textsl{Pad Kit}.

%-------------------------------------------------------------------------------
% vim: ts=3 sw=3 et ft=tex
%-------------------------------------------------------------------------------
