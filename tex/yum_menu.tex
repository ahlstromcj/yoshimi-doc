%-------------------------------------------------------------------------------
% yum_menu
%-------------------------------------------------------------------------------
%
% \file        yum_menu.tex
% \library     Documents
% \author      Chris Ahlstrom
% \date        2015-05-11
% \update      2021-10-08
% \version     $Revision$
% \license     $XPC_GPL_LICENSE$
%
%     Provides the Menu section of the manual.
%
%-------------------------------------------------------------------------------

\section{Menu}
\label{sec:menu}

   We're now ready to describe the user-interface of \textsl{Yoshimi}!
   The \textsl{Yoshimi} menu, as seen at the top of
   \figureref{fig:yoshimi_main_screen},
   is fairly simple, but it is important to understand the
   structure of the menu entries.

\subsection{Menu / Yoshimi}
\label{subsec:menu_yoshimi}

   The \textsl{Yoshimi}
   menu entry contains the sub-items shown in
   \figureref{fig:yoshimi_menu_items}.
   \begin{figure}[H]
   \centering
   \includegraphics[scale=1]{2.0/Menu.png}
   \caption[Yoshimi Menu, Exit]{Yoshimi Menu}
   \label{fig:yoshimi_menu_items}
\end{figure}
   The next few sub-sections discuss the sub-items in the
   \textsl{Yoshimi} sub-menu.

\begin{figure}[H]
   \centering
   \includegraphics[scale=1]{2.3.0/menu_yoshimi.png}
   \caption[Yoshimi Menu, Exit]{Yoshimi Menu}
   \label{fig:yoshimi_view_yoshimi}
\end{figure}

   The items it contains are:

   \begin{enumber}
      \item \textbf{About...}
      \item \textbf{New instance}
      \item \textbf{Settings...}
      \item \textbf{Reports...}
      \item \textbf{View Manual...}
      \item \textbf{Exit}
   \end{enumber}

   \index{Vectors}
   The \textbf{Vectors} menu entry of version 1.4.0 has been moved to its own
   button in version 1.4.1, as can be seen in the figure.  See
   \sectionref{subsec:vector_dialogs}, which presents this dialog and
   describes it.

   \index{Reports}
   \textbf{Reports} This opens the \textsl{Yoshimi} console window.
   It has been swapped with MIDI-learn, which now has the button on the main window.
   Note that this will only show any messages if reports are not going to
   \texttt{stdout}. This can be changed by setting \textbf{Yoshimi / Settings
   / Main Settings / Send reports to:} to \textsl{Console Window}
   (for this item see
   \sectionref{paragraph:menu_yoshimi_settings_main_settings}.)

   \index{new!View Manual}
   \textbf{View Manual} This currently requires that a PDF viewer
   be installed.
   Note that some viewers might not work properly
   (e.g. \texttt{apvlv} (\cite{apvlv}).

\subsubsection{Menu / Yoshimi / About...}
\label{subsubsec:menu_yoshimi_about}

   There is no \textbf{Help} menu in \textsl{Yoshimi}.  Therefore, the
   \textbf{About} dialog appears in the \textbf{Yoshimi} menu, as shown in
   \figureref{fig:yoshimi_about_dialog}.
   These guys need some acknowledgement for their hard work!
   And they acknowledge the massive groundwork laid by the
   \textsl{ZynAddSubFX} project.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.8]{2.3.0/about.png}
   \caption{Yoshimi Menu, About Dialog}
   \label{fig:yoshimi_about_dialog}
\end{figure}
    This has a new 'more' button that changes the window to an alphabetic list of
    all those who have helped Yoshimi. Sometimes just a hint from these friends
    has been enough to pave the way for extensive improvements.
\begin{figure}[H]
   \centering
   \includegraphics[scale=0.8]{2.3.0/contributors.png}
   \caption{Yoshimi Menu, Contributors}
   \label{fig:yoshimi_contributors}
\end{figure}

\subsubsection{Menu / Yoshimi / New instance}
\label{subsubsec:menu_yoshimi_new_instance}

   The \textbf{New instance} menu entry creates a new instance of
   \textsl{Yoshimi}.  If JACK is running, start a normal (JACK-using) instance
   of \textsl{Yoshimi}.  Then use this menu entry.  \textsl{Yoshimi} will start
   another instance of itself, with a prompt to accept the next available
   instance ID or to change it.  The presence of this instance can be verified
   by running a JACK session manager such as \textsl{QJackCtl}.
   In a non-JACK setup it won't fail, but in the absence of any specific
   setting, it will have null audio, but (probably) will still connect to ALSA
   MIDI.

   It is important to note that each instance of \textsl{Yoshimi} has its
   own configuration file.  Each also has its own MIDI and audio ports.
   Thus, these instances are partly independent of each other.
   (They can share some information, such as copy/paste.)
   The new instance tries to open a \textsl{Yoshimi} instance based on the
   configuration found in the file
   \texttt{\textasciitilde/.config/\-yoshimi/\-yoshimi-XX.instance}, where
   \textsl{XX} is the ID one supplied.

   Opening a new instance creates a copy that has it's own dynamic memory for
   running storage. Some data (such as recent history and copy/paste buffers) is
   shared between instances.
%  This is done only where instances actually need to be in sync.
   The bank structure is partially synchronised, but needs more work.

%  Each instance has it's own file-store in \textsl{Yoshimi}'s configuration
%  directory. The means that if one opens a numbered instance, one will get
%  back all the settings that were previously used for that instance.

   Instances no longer fight for access to JACK/ALSA audio; they simply
   try to find another route to a soundcard. Failing to find one,
   they revert to null audio, but nonetheless start cleanly.

   The list of hidden "base parameters" that are set only by the main instance
   is now:

   \begin{itemize}
      \item XML Compression Level
      \item Show Splash Screen
      \item Enable GUI
      \item Enable CLI
      \item Enable Auto Instance
      \item Enable Single Master
   \end{itemize}

   In the other instances these are now hidden instead of deactivated.  This
   behaviour makes sense, as they are \textsl{never} enabled in the other
   instances of \textsl{Yoshimi}. This is more consistent, making
   \textsl{Yoshimi}'s configuration directory more tidy. These entries are
   also hidden when \textsl{Yoshimi} is being used as an LV2 plugin as they
   are not relevant at all in that environment.

\subsubsection{Menu / Yoshimi / Settings...}
\label{subsubsec:menu_yoshimi_settings}

   The \textsl{Yoshimi Settings} dialog contains six tabs that control the
   major and overall settings of \textsl{Yoshimi}.

   \textbf{Settings} window.

   At the bottom of this dialog is a \textbf{Close} button which closes the
   \textsl{Yoshimi} settings dialog. There used to be a \textbf{Save and Close}
   button as well, but since \textsl{Yoshimi} version 2.3.3 that is no longer
   needed, as all configuration changes are saved immediately. This simplifies
   a number of technical issues, as well as being more convenient for users.

   Here are the tabs included in the main settings of \textsl{Yoshimi}
   as of version 2.3.3; each is described in its own section.

   \begin{itemize}
      \item \textbf{Main settings}
      \item \textbf{Switches}
      \item \textbf{Jack}
      \item \textbf{Alsa}
      \item \textbf{MIDI}
      \item \textbf{Theme}
   \end{itemize}

\paragraph{Menu / Yoshimi / Settings / Main Settings}
\label{paragraph:menu_yoshimi_settings_main_settings}

   The Main Settings tab controls the main configuration items that
   follow, which apply to all patches/instruments.
   The main settings are shown in
   \figureref{fig:yoshimi_main_settings_tab}.
   Some settings only take effect after restarting the synthesizer.
   In \textbf{Main settings}, only the items marked with an asterisk ('*')
   need a restart.
   The settings dialogs have changed gradually as
   \textsl{Yoshimi} has progressed.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.5]{2.3.3/settings.png}
   \caption{Yoshimi Main Settings Tab}
   \label{fig:yoshimi_main_settings_tab}
\end{figure}

   The following settings exist in the \textsl{Main settings} tab:

   \begin{enumber}
      \item \textbf{Internal Buffer Size}
      \item \textbf{AddSynth Oscillator Size}
      \item \textbf{PadSynth Interpolation}
      \item \textbf{PadSynth Wavetable Build Mode}
      \item \textbf{Virtual Keyboard Layout}
      \item \textbf{XML compression level}
      \item \textbf{Send reports to}
      \item \textbf{Console Text Size}
      \item \textbf{Saved instrument Format}
      \item \textbf{Mixer Panel Layout}
   \end{enumber}

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

   \itempar{Internal Buffer Size}{Main Settings!buffer size}
   This item was updated with version 1.3.6.  It is actually the old
   \textbf{Period Size} field from the \textbf{Alsa} tab.
   It sets the granularity of the sound generation.
   To find out the internal delay in milliseconds, divide the
   buffer-size value by the sample-rate, then multiply the result by 1000:
   For example, \(256 / 44100 * 1000 = 5.8 ms\).

   The default internal buffer size has been reduced from 1024 to 256.  One
   gets better latency that way.  Almost all modern computers can run
   \textsl{Yoshimi} with the current default (smaller) buffer-size value, and
   many will do so at 64 frames (and even 16 frames!)
   without any special precautions.

   Note that, for ALSA, if the audio destination is "default",
   then ALSA decides on the buffer size (among other settings), and
   \textsl{Yoshimi} will set it's internal buffer size to match,
   which always seems to be 1024.

   Values: \texttt{64, 128, 256*, 512, 1024, 2048, 4096, 8192}

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{2.3.1/main_internal_size.png}
   \caption[Internal Size Values]{AddSynth Internal Buffer Size)}
   \label{fig:yoshimi_internalsize_values}
\end{figure}

   \itempar{AddSynth Oscillator Size}{Main Settings!oscillator size}
   ADDsynth Oscillator Size (in samples).  This item used to be called
   "OscilSize".  Sets the number of the points of the ADDsynth oscillator.
   Bigger is better, as it results in a more mathematically-correct waveform,
   but it takes more CPU, though it has no effect on latency.
   In an all-JACK environment, JACK determines the latency.  There are very few
   occasions where one might want the internal buffer smaller than the JACK
   size, and none where it should be bigger. If it is bigger, the extra space
   will (to a small degree) represent wasted memory and processor use.

% This link will fail because that TeX file is commented out due to build issue
% and perhaps a lack of relevance.
%
% See \sectionref{sec:resource_usage_buffer_sizes}, which
%  goes into performance-related details.

   The default value for \textsl{Yoshimi} is shown marked with an asterisk.
   \index{asterisk}
   \index{default!asterisk}
   This asterisk/plus-sign convention is used throughout this manual.
   See \figureref{fig:yoshimi_oscilsize_values},
   shown below for the AddSynth Oscillator Size drop-down element.

   Values: \texttt{256, 512*, 1024, 2048, 4096, 8192, 16384}

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{menu/Yoshimi/main-oscilsize.jpg}
   \caption[OscilSize Values]{AddSynth Oscillator Size (samples)}
   \label{fig:yoshimi_oscilsize_values}
\end{figure}

   \itempar{PADsynth Interpolation}{Main Settings!PADsynth Interpolation}
   See \figureref{fig:padsynth_interpolation}, shown below,
   for the interpolation values.
   From an email conversation with Paul Nasca, Will notes that
   the sound improvement with cubic interpolation is quite subtle, and requires
   a well designed audio setup, a PADsynth instrument with a fair amount of
   high-frequency content... and good hearing!

   Values: \texttt{Linear(fast)*, Cubic(slow)}

\begin{figure}[H]
   \centering
   \includegraphics[scale=1.0]{menu/Yoshimi/main-padsynth-interpolation.jpg}
   \caption[PADSynth Interpolation]{PADSynth Interpolation Values}
   \label{fig:padsynth_interpolation}
\end{figure}

   \itempar{PadSynth Wavetable Build Mode}{Main Settings!PadSynth Wavetable Build Mode}

   PadSynth wavetables have to be generated before they can be played, and this can take
   some time. Previously this always involved silencing the whole part, building the
   wave table, then restarting the part. While this \textsl{Muted} mode is still
   available for older computers, there are now two other build modes.
   \textsl{Background}, as the name implies will let one continue using an existing
   wavetable while it builds a new one, then notifies that it is ready to be applied.
   Finally, \textsl{Auto-Apply} also builds the new wavetable without disrupting one's
   playing, then applies it as soon as it is ready.

   Values: \texttt{Muted, Background*, Auto-Apply}

   \itempar{Virtual Keyboard Layout}{Main Settings!Virtual Keyboard Layout}
   The virtual keyboard is useful, but it is difficult to move the mouse
   rapidly to the next key on the virtual keyboard.
   Therefore, \textsl{Yoshimi} supports using the computer keyboard
   to produce notes.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.45]{2.0/VirtualKeyboard.png}
   \caption{QWERTY Virtual Keyboard Layout}
   \label{fig:qwerty_virtual_keyboard}
\end{figure}

   See \figref{fig:qwerty_virtual_keyboard}, for the mapping of the computer keyboard to
   the virtual keyboard. Three octaves are available, with the dark keys of each colour
   representing the "black" keys.
   Note that this is a QWERTY layout.
   \textsl{Yoshimi} also supports other keyboard layouts.
   See \figureref{fig:virtual_kbd_layout},
   for the virtual keyboard layout settings drop-down.

   Values: \texttt{QWERTY*, Dvorak, QWERTZ, AZERTY}

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{menu/Yoshimi/main-virtual-kbd-layout.jpg}
   \caption[Virtual Keyboard Layout]{Virtual Keyboard Layout Values}
   \label{fig:virtual_kbd_layout}
\end{figure}

   \itempar{XML compression level}{Main Settings!XML compression level}
   Gzip Compression level of \textsl{Yoshimi} XML files.
   The settings and instruments of
   \textsl{Yoshimi}
   are preserved in XML files.
   The value of 0 indicates that the XML file is uncompressed.

   In general, 0 is a setting for debugging only.  Setting this
   option makes the XML files a bit larger, perhaps larger by a factor of more
   than 10, making a 10K file into a 180K file.  For a little "wasted" space
   and time, one can view the XML file in a text editor.  If
   one's system is tight on disk space, higher levels of compression can be
   specified.  Using XML compression can also save file access time which may
   be beneficial if one's computer is borderline on latency.  This setting
   should stay at 3 if one is going to make instruments publicly available, as
   some older versions of Yoshimi don't recognise uncompressed files. This
   also applies if one is going to save large patchsets that will be loaded
   while running. Uncompressing is \textsl{much} faster than file loading.

   Values: \texttt{0 to 9, 3*}

   \itempar{Send reports to}{Main Settings!Send Reports Destination}
   Notices and error messages can be sent to the standard error log of
   the terminal in which
   \textsl{Yoshimi} can be run, or, more usefully, to
   an output console window.
   In some versions of Yoshimi these messages were pushed in reverse order, to
   avoid manually scrolling and to make the most recent statuses easily visible.
   However, a method has now been found to auto-scroll and keep the most recent
   entry visible, so new entries are in normal reading order.

   See \figureref{fig:send_reports_to}.
   It provides a depiction of the selection drop-down.

   Values: \texttt{stderr*, Console Window}

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{menu/Yoshimi/main-send-reports-to.jpg}
   \caption[Send Reports]{Send Reports To}
   \label{fig:send_reports_to}
\end{figure}

   If the \textbf{Console Window} option is chosen, then a small console dialog
   will be opened, as shown in \figureref{fig:console_window}. If this is closed,
   it can be re-opened from the \textsl{Yoshimi} menu.

\begin{figure}[H]
   \centering
   \includegraphics[scale=1.0]{1.6.0/Console.png}
   \caption[Yoshimi Console Window]{Console Window}
   \label{fig:console_window}
\end{figure}

   Note that numbers that are shown (such as part numbers) all start from 1,
   not 0.

   \begin{verbatim}
        Loaded 65 "Hyper Arpeggio" to Part 1
        Loaded 10 "Arpeggio11" to Part 2
        Loaded 41 "Soft Arpeggio4" to Part 3
        Loaded 67 "Glass Arpeggio1" to Part 4
   \end{verbatim}

   \itempar{Console Text Size}{Main Settings!Console text Size}
   New in V2.1.0.

   The Console window was always resizeable so that one could change the length
   of lines, or number of lines visible. This meant we couldn't realistically
   make the contents (i.e. the text) resize automatically. The new control allows
   one to set a suitable text font size.

   Values: \texttt{11 to 100, 12*}

   \itempar{Saved instrument Format}{Main Settings!instrument file format}
   This new (1.5.5) feature provides a choice between the old instrument
   format and a new format.
   The \textbf{Legacy} format has a file extension \texttt{.xiz}.
   The \textbf{Yoshimi} format has a file extension \texttt{.xiy}.

   Values: \texttt{Legacy (.xiz), Yoshimi (.xiy), Both (.xiz + .xiy)}

   Some users wanted a way to store the \textbf{Controllers} settings
   with an instrument, as they can make a dramatic difference to the
   sound. There is now a superset of instruments that can be saved instead
   of, or as well as, the standard ones. On loading, \textsl{Yoshimi}
   will look for the extended version (\texttt{.xiy}) first.
   This applies to instruments in banks, as well as
   externally saved instrument.
   If one has an extended type loaded, the instrument
   name will be in a blue font, instead of black.
   This also applies to the stored instruments in bank slots.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{2.3.0/yoshimi_type_font.png}
   \caption[Yoshimi Font for Extended File Format]{Extended File Format Font}
   \label{fig:extended_file_format_font}
\end{figure}

   This is part of the rationale of the new instrument format: We will
   \textsl{never} make any changes to the standard instruments, and one will always
   be able to load and save them. However, we will incrementally add improvements
   and refinements to the new format, with compatible
   adjustments for the standard-format instruments, where appropriate.

   There is a caveat when handling instruments in banks. If one sets for
   only \textbf{Legacy} or only \textbf{Yoshimi}, but have previously set
   for both, saving to such a dual entry will erase the one that wasn't
   selected. Currently, it is not known why that happens (banks are
   'interesting').

   \itempar{Mixer Panel Layout}{Main Settings!mixer panel layout}
   This enables one to set either a single row of 16 parts, or a 'box'
   style of two rows of eight. It performs the same function as the one
   in the mixer window itself. This has been placed here as it has been
   found that with very low resolution screens and some window managers
   it is possible for the mixer panel's own selector to disappear off the
   screen in an unrecoverable manner.

\paragraph{Menu / Yoshimi / Settings / Switches}
\label{paragraph:menu_yoshimi_settings_switches}

   Many of the check-box items have been moved into this new tab, to reduce
   clutter.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.5]{2.3.3/switches.png}
   \caption{Yoshimi Switches Tab}
   \label{fig:yoshimi_settings_switches_tab}
\end{figure}

   The following settings exist in the \textsl{Switches} tab:

   \begin{enumber}
      \item \textbf{Enable Bank Highlight}
      \item \textbf{Hide Non Fatal Errors}
      \item \textbf{Show Splash Screen}
      \item \textbf{Log XML Headers}
      \item \textbf{Log Load times}
      \item \textbf{Retain all data}
      \item \textbf{Enable GUI}
      \item \textbf{Enable CLI}
      \item \textbf{Enable Auto Instance}
      \item \textbf{Enable Single Master}
      \item \textbf{Start With Default State}
   \end{enumber}

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.
    \index{new!Enable Bank Highlight}
   \itempar{Enable Bank Highlight}{Switches!Enable Bank Highlight}
   Setting this will highlight the most recent instrument either loaded from, or saved to a bank. It will be printed in bold text so will really stand out. This is especially useful where instruments have a different internal name to their filename.

   \itempar{Hide Non Fatal Errors}{Main Settings!Hide Non-Fatal Errors}
   Especially when running from the command line (with reports going there
   too), under some circumstances one can get a swamp of low-level error
   messages (such as XRUNs) that is so large that one cannot work out what is
   going on. This feature disables these error messages; it is a work in
   progress to catch the bulk of them, while still reporting top-level messages
   and ones that cause a forced exit (surely not!)

   \itempar{Show Splash Screen}{Main Settings!Show Splash Screen}
   This item will speed up the start-up of \textsl{Yoshimi} slightly
   if unchecked, by not showing the splash screen while files are being loaded.

   \itempar{Log XML Headers}{Main Settings!Log XML headers}
   This item sends the information to the console window
   (or \texttt{stderr}) so that
   one can then see what \textsl{Yoshimi}
   version created the file.

   \itempar{Log Load times}{Switches!Log Load times}
   Provides a way of noting problematic patch sets, which may take a long
   enough time to load so as to affect the smoothness of playback.

   \itempar{Retain all Data}{Main Settings!Retain all data} Allows disabled data
   to be stored in the XML file. This makes it a lot easier to re-enable a setting
   later. However, the file size will be significantly greater.

   \itempar{Enable GUI}{Switches!Enable GUI}
   If checked, the user-interface is enabled.  This setting is normally what one
   wants.  If one unchecks it, it warns that disabling the GUI
   can only be reversed from the command line.

   \itempar{Enable CLI}{Switches!Enable CLI}
   If checked, the command-line interface is enabled.
   Note as of V 1.5.6 it has been possible to disable both the user-interface and
   the command line at the same time. This means that Yoshimi can only be closed
   by sending a special MIDI message (CC 99, 68, CC 98, 68). Alternatively one
   could send a system shutdown message.

   \itempar{Enable Auto Instance}{Switches!Enable Auto Instance}
      If checked, then, if any other instances were open at the time one closes
      the main instance, then these other instances will be re-opened next time
      one runs \textsl{Yoshimi}.

   If these instances each have their own
   \textbf{Start with Default State} switch checked, and if
   there is a valid default state for them, then these instances will also have
   their default state loaded.
   Therefore, just by starting the main instance, one can have a
   highly-detailed multi-instance setup installed.
   This setup will include such things as JACK/ALSA audio
   and MIDI, and a complete patch set, etc.

   \itempar{Enable Single Master}{Switches!Enable Single Master}
      If checked, then once running, trying to start a new instance from the
      desktop ( or command line) will instead get the next available instance in
      the currently running one. This is both more efficient use of resources,
      and ensures consistency because top-level instances cannot communicate
      independently changed configuration settings. (new from V 1.6.0)

   \itempar{Start With Default State}{Switches!Start With Default State}
   Requires \textsl{Yoshimi} to be restarted, to take effect.
   This setting allows \textsl{Yoshimi} to be initialised with one's own
   initial state file that matches one's usual work setup.
   The default state file is named
   \texttt{\textasciitilde/.config/yoshimi/yoshimi.state}.

   If the \textbf{Reset} button on the main screen is clicked, then this file
   is loaded, instead of reverting to the first-run default state of
   \textsl{Yoshimi}.

   \paragraph{Menu / Yoshimi / Settings / Switches / History Locks}
   \label{paragraph:menu_yoshimi_settings_historylocks}
   \index{new!History Locks}
   New in \textsl{Yoshimi} V 1.6.0 there is a sub-panel \textsl{History Locks}

   This is a set of config switches so that one can independently lock each of
   the history lists against change. In the locked state loading or saving new
   files will not update the associated history list at all. At any time, these
   lists can of course be unlocked again. This is especially useful when changing
   these settings via MIDI NRPNs (also new).

   \begin{enumber}
      \item \textbf{Instrument}
      \item \textbf{Patch Set}
      \item \textbf{Scale}
      \item \textbf{State}
      \item \textbf{Vector}
      \item \textbf{Midi Learn}
   \end{enumber}

   The default state is 'unlocked' as shown in the image above, retaining
   compatibility with older versions of \textsl{Yoshimi}.

   Finally, the history file is unique in that it is entirely internally
   generated, and the file is common across all instances. Although treated as
   a config setting, the new switch settings are actually embedded in the
   history file itself, which ensures consistency.


\paragraph{Menu / Yoshimi / Settings / Jack}
\label{paragraph:menu_yoshimi_settings_jack}

   JACK is the "Jack Audio Connection Kit", very useful for increasing audio
   performance and configurability.
   When using the JACK audio backend, instruments can be individually routed
   and sent to the main L/R outputs. This is controlled from the
   panel window,
   \sectionref{subsec:mixer_panel_window},
   and the settings are saved with all the other parameters.

   Direct part outputs are only available to Jack, and include the Part and
   Insertion effects, but not the System ones.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.5]{2.3.3/jack.png}
   \caption[JACK Settings]{JACK Settings Tab}
   \label{fig:yoshimi_settings_jack_tab}
\end{figure}

   The following items are provided by the Jack settings:

   \begin{enumber}
      \item \textbf{Jack Midi Source}
      \item \textbf{Set as preferred MIDI}
      \item \textbf{Jack Server}
      \item \textbf{Set as preferred audio}
      \item \textbf{Autoconnect audio} (new, 1.3.9)
   \end{enumber}

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

   \itempar{Jack Midi Source}{JACK!MIDI source}
   Jack MIDI Source.
   It is possible to have more than one JACK MIDI source.  This option
   tells this instance of \textsl{Yoshimi} which JACK
   client to try to auto-connect to for MIDI input.
   This option corresponds to the \textsl{Yoshimi} command line option
   \texttt{--jack-midi(=device)}.

   Values: \texttt{default*, name} name; see "man jackd" for details.

   \itempar{Set as preferred MIDI}{JACK!set as preferred MIDI}
   Set as preferred MIDI for JACK.
   This setting determines which MIDI connections a particular instance will
   first attempt. The switches are mutually exclusive across JACK and ALSA,
   so if one checks ALSA for MIDI, it automatically unchecks JACK for MIDI.
   As well as from the GUI, this setting can be set (for instance 0) from the
   command line, both at start-up and once running.

   \itempar{Jack Server}{JACK!server name}
   Jack Server Name.
   It is possible to have more than one JACK server running.  This option
   tells this instance of \textsl{Yoshimi} which JACK server to use.
   This option corresponds to the \textsl{Yoshimi} command line option
   \texttt{--jack-audio(=server)}.

   Values: \texttt{default*, name} name, as set by
   \texttt{jackd --name}; see "man jackd" for details.

   \itempar{Set as preferred audio}{JACK!set as preferred audio}
   Set as preferred audio for JACK.
   This setting determines which audio connections a particular instance will
   first attempt. The switches are mutually exclusive across JACK and ALSA,
   so if one checks ALSA for audio, it automatically unchecks JACK for audio.
   As well as from the GUI, this setting can be set (for instance 0) from the
   command line, both at start-up and once running.
   Note that any of these setting changes require a restart of \textsl{Yoshimi}
   to take effect.

   \itempar{Autoconnect audio}{JACK!autoconnect audio}
   Sets \textsl{Yoshimi} to connect automatically to the JACK server, just like
   the \texttt{-K} command-line option does.
   (However, note that the command-line has no way to disable this feature if
   the configuration has been saved.)
% the above my need revision

\paragraph{Menu / Yoshimi / Settings / Alsa}
\label{paragraph:menu_yoshimi_settings_alsa_tab}

   A significant improvement is to the handling of ALSA audio, which is still
   very important for some people. Until now, \textsl{Yoshimi} has insisted
   on a 2-channel, 16-bit format. Tests have shown that virtually all
   motherboard sound chipsets will handle this, but many external ones don't.

   From \textsl{Yoshimi} 1.3.6 onward, when using ALSA audio,
   \textsl{Yoshimi} first tries to connect 2 channels at 32 bit depth.  If
   that connection does not succeed, then \textsl{Yoshimi} negotiates
   whatever the soundcard will support.  For example, a card might support
   only 24 bits, and 6 channels.  So \textsl{Yoshimi} will fall back to
   24 bit, and, due to its own limits, will use only channels 1 and 2.
   With external sound modules in mind, endian swaps are also implemented.

   To be able to reliably use ALSA audio, one needs to set a card name, not just
   "Default".  In a terminal window enter the following command:

   \begin{verbatim}
      $ cat /proc/asound/card*/id
   \end{verbatim}

   The result of this command should be something like:

   \begin{verbatim}
      PCH
      K6
   \end{verbatim}

   Go to the ALSA settings tab illustrated below, and in
   \textsl{Alsa Audio Device} enter, for example, "hw:PCH".
   This ensures one will always connect to this card at startup regardless of
   the order this and of other cards.  Another benefit of using this hardware name
   is that ALSA will now use \textsl{Yoshimi}'s internal
   buffer size (default 256), otherwise ALSA will force \textsl{Yoshimi} to accept its
   default size (usually 1024).

   One can also set the sample rate, but bear in mind that not all cards can use
   all of these.  The sample rates 44100 and 48000 are almost always available.
   If one sets a Midi Device as well (such as a keyboard) Yoshimi will try to
   find and connect to this device at startup.

   To find the MIDI devices available, try:

   \begin{verbatim}
      $ grep Client /proc/asound/seq/clients
   \end{verbatim}

   The result of this command should be something like:

   \begin{verbatim}
      Client info
      Client   0 : "System" [Kernel]
      Client  14 : "Midi Through" [Kernel]
      Client 128 : "TiMidity" [User]
   \end{verbatim}

   It is not obvious how ALSA audio is controlled and who takes command.  If
   one sets a specific audio destination, then \textsl{Yoshimi} makes a
   request.  It's often a negotiation on bit depth and channel count, but
   \textsl{Yoshimi} nearly always gets to decide the buffer size, which is the
   internal buffer size.  However, if the destination is 'default' then ALSA
   decides on the sound card, bit depth, number of channels and the buffer
   size, and \textsl{Yoshimi} will set it's internal buffer size to match.  On
   most machines this seems to be 1024.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.5]{2.3.3/alsa.png}
   \caption[ALSA Settings]{ALSA Settings Tab}
   \label{fig:yoshimi_settings_alsa_tab}
\end{figure}

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

   \index{new!Alsa Connection Type}
   \itempar{Alsa Connection Type}{ALSA!MIDI Connection Type}
   ALSA MIDI Connection Type.
   This feature was added in \textsl{Yoshimi} V 1.6.1 and is a dropdown
   list with the following three options.

   Values: \texttt{Fixed, Search*, External}

   \textbf{Fixed} is the original arrangement, and activates the Alsa Midi Source
   control below.

   \textbf{Search} will search for and connect to any MIDI sources that are
   available and is aimed particularly at new users.

   \textbf{External} doesn't make any attempt to connect at all, so one would
   then do so by some other means.

   Notice that the default is now the second option. However this will not
   affect existing users, who will see it as 'Fixed' until such time as they
   change it themselves.

   \itempar{Alsa Midi Source}{ALSA!MIDI Source}
   ALSA MIDI Source.
   The purpose of this setting is the same as the command line option
   \texttt{--alsa-midi="name"}.
   It is used so that \textsl{Yoshimi} can auto connect to a MIDI source
   such as a keyboard.  For example, the one that Will has identifies itself
   as name = "Hua Xing".
   A port name, such as "128:0" (for one of the ports provided by
   \textsl{TiMidity}) should work as well, but beware of USB MIDI devices that
   might not have the same port numbers each time.
   \index{new!multiple sources}

   An extension was also added here during the development of
   \textsl{Yoshimi} V 1.6 so that one can have a comma separated list of
   sources. These will be searched for and connected if found. This is
   especially useful if wanting a known variety of keyboards and/or
   controllers connected, but only those in a comparatively congested MIDI
   setup.

   Values: \texttt{default*}

   \itempar{Set as preferred MIDI}{ALSA!Set as preferred MIDI}
   Set as preferred MIDI for ALSA.
   This setting determines which MIDI connections a particular instance will
   first attempt. The switches are mutually exclusive across JACK and ALSA,
   so if one checks ALSA for MIDI, it automatically unchecks JACK for MIDI.
   As well as from the GUI, this setting can be set (for instance 0) from the
   command line, both at start-up and once running.

   \itempar{Alsa Audio Device}{ALSA!audio device}
   ALSA Audio Device.
   This specifies the sound card to which \textsl{Yoshimi} can connect.
   Normally, this will be an ALSA hardware specification such as
   "hw:0".
   ALSA audio also lets one connect to a sound card by name. For example,
   with a Komplete Audio KA 6 sound card, the device specification is
   "hw:K6". This feature is particularly useful for USB modules, as one can
   never be sure where they appear numerically.

   Values: \texttt{default*}

   Note, that if it is left as "default" then all aspects will be at their
   default settings. This includes sample rate and buffer size.

   \itempar{Set as preferred audio}{ALSA!Set as preferred audio}
   Set as preferred audio for ALSA.
   This setting determines which audio connections a particular instance will
   first attempt. The switches are mutually exclusive across JACK and ALSA,
   so if one checks ALSA for audio, it automatically unchecks JACK for audio.
   As well as from the GUI, this setting can be set (for instance 0) from the
   command line, both at start-up and once running.

   \itempar{Sample Rate}{ALSA!sample rate}
   Sample Rate.
   Sets the quality of the sound, higher is better, but it uses more CPU.  One
   can select from a list.  Note that both ALSA and JACK will support the
   192000 rate, if the sound-card supports it.  To find out the internal delay
   in milliseconds, divide the buffer-size value by the Sample Rate and
   multiply the result by 1000 (256 / 44100 * 1000 = 5.8 ms).

   Note that, as of version 1.3.6, the \textbf{Period Size} field has been
   removed from the \textbf{Alsa} tab, and is replaced by the
   \textbf{Internal Buffer Size} field in the \textbf{Main Settings} tab.
   Note that any of these setting changes require a restart of \textsl{Yoshimi}
   to take effect.

   Values: \texttt{192000, 96000, 48000*, 44100}

\paragraph{Menu / Yoshimi / Settings / MIDI CCs}
\label{paragraph:menu_yoshimi_settings_ccs}

   The CC settings tab has been renamed to "MIDI CCs" tab.
   This tab, shown in
   \figureref{fig:yoshimi_settings_cc},
   presents MIDI bank-root, bank, program change, and extended program
   change settings, plus some new values.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.5]{2.3.3/midi.png}
   \caption[MIDI Preferences]{MIDI Preferences Tab}
   \label{fig:yoshimi_settings_cc}
\end{figure}

   A recent feature is that some changes to the items in this
   tab cause a red \textbf{Pending} button to appear.  Pressing this
   button saves that particular change.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.5]{2.3.3/midi_cc_pending.png}
   \caption[MIDI Settings Pending]{MIDI Settings Pending}
   \label{fig:yoshimi_settings_pending}
\end{figure}

   The following items are provided by the MIDI CCs settings tab:

   \begin{enumber}
      \item \textbf{Bank Root Change}
      \item \textbf{Bank Change}
      \item \textbf{Enable Program Change}
%     \item \textbf{Enable Part On Program Change}
      \item \textbf{Enable Extended Program Change}
      \item \textbf{Extended Program Change}
      \item \textbf{Enable Incoming NRPNs}
      \item \textbf{Ignore Reset all CCs}
      \item \textbf{Log Incoming CCs}
      \item \textbf{Show Learn Editor}
   \end{enumber}

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

   The concepts of banks and roots is very useful.
   See \sectionref{subsec:concepts_banks_and_roots}.
   The settings in this tab affect the usage of banks and root changes
   controlled by MIDI messages, thereby making \textsl{Yoshimi} able to
   implement MIDI automation.

   For many of the controls in this section, if the control number is
   already in use for another purpose, one might get a warning like the
   following:

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{2.3.0/setting_in_use.png}
   \caption[MIDI Setting In Use]{MIDI Setting In Use}
   \label{fig:yoshimi_settings_in_use}
\end{figure}

   \itempar{Bank Root Change}{MIDI settings!bank root change}
   Bank Root Change.
   Defines which MIDI controller one wants to use. This has been changed in
   V 1.5.11 so that it is consistent with Bank Change.

   Values: \texttt{LSB, MSB*, Off}

   \itempar{Bank Change}{MIDI settings!bank change}
   Bank Change.
   Defines which MIDI controller one wants to use.

   Values: \texttt{LSB, MSB*, Off}

   When combined, these Bank Select messages provide
   \texttt{128*128} = 16384 banks.

   Note that normally MIDI Controller 0 = CC0 = Bank Select MSB, and MIDI
   Controller 32 = CC32 = Bank Select LSB. Also a Bank (and Bank Root)
   selection simply makes these available for the next Program Change event.
   The program doesn't change after changing a bank, until an actual Program
   Change is sent. Bank/Root changes can be completely disabled, as some
   hardware synthesizers don't play nice with banks when used to send MIDI.

   \itempar{Enable Program Change}{MIDI settings!enable program change}

   Values: \texttt{Off*, On}

   Enables/disables MIDI program change.
   Program changes can be completely disabled, as some hardware synths don't
   play nice when used to send MIDI.

   The part is automatically enabled if the MIDI program was changed on this
   part.  There is no longer an option to disable this enabling.

   \itempar{Enable Extended Program Change}{MIDI settings!enable extended
   program change}

   Values: \texttt{Off*, On}

   \itempar{Extended Program Change CC}{MIDI settings!extended change}
   If enabled, a new reddish button, \textbf{Pending}, appears.
   Once the change has been made in the scroll list, click this button
   to set the change.
   \textbf{Warning:}
   The \textbf{Save and Close} button will not result in the removal of the
   \textbf{Pending} button.
   This result seems counter-intuitive, but the pending button is not removed
   here because, at that point, it still hasn't actually been either set or
   abandoned. It remains available for when the user actually makes up their
   mind.

   Values: \texttt{0-127, 110*}

   \itempar{Enable Incoming NRPNs}{MIDI settings!enabable incoming NRPN}
   Set by default, so one might not notice it at first.
   Disabling incoming NPRNs stops rogue MIDI sources from screwing things up.
   Disabling it also lets one use the NRPN CCs for other functions,
   if wanting to use a programmable hardware controller.

   Values: \texttt{Off, On*}

   \itempar{Ignore Reset all CCs}{MIDI settings!Ignore Reset all CCs}
   Causes \textsl{Yoshimi} to ignore this message.
   \index{CC monitor}
   For example, using \textsl{Yoshimi}'s CC monitor (see the next
   item), Will found that one software sequencer was sending CC 121 (reset all
   controllers) at the start of some song segments.  Checking this option
   prevents unwanted resets.

   Values: \texttt{Off*, On}

   \itempar{Log Incoming Events}{MIDI settings!Log Incoming MIDI Events}
   This setting is now saved (in the \texttt{config} file). It is there
   as an aid for when \textsl{Yoshimi} appears to ignore MIDI commands,
   as it tells one exactly what \textsl{Yoshimi} thinks it received.

   Values: \texttt{Off*, On}

   \itempar{Show Learn Editor}{MIDI settings!Show Learn Editor}
   Sets whether the MIDI Learn editor window is to be opened when learning a
   new control. One might find that when learning a new control one
   wants to change the \textbf{Min} and \textbf{Max} settings.

   Values: \texttt{Off, On*}

\paragraph{Menu / Yoshimi / Settings / Themes}
\label{paragraph:menu_yoshimi_settings_themes}
    From \textsl{Yoshimi} Version 2.3.0 one can change the colours of almost
    all parts of all windows. A slight variation of the original colours is now
    called 'classic', and this will always be available. There is also quite an
    extreme demonstration of what is possible.

    There is enough new information to justify a separate discussion of this, so
    full details can be found in \sectionref{sec:themes}\hspace{4pt}.

\subsubsection{Menu / Yoshimi / View Manual...}
\label{subsubsec:menu_yoshimi_view_manual}

   This menu entry brings up the most recent version of this manual, which is
   now included as part of a \textsl{Yoshimi} installation.
   Note that some viewers might not work properly
   (e.g. \texttt{apvlv} (\cite{apvlv}).

\subsubsection{Menu / Yoshimi / Exit}
\label{subsubsec:menu_yoshimi_exit}

   Simply exits from \textsl{Yoshimi}. There used to be a warning if there were
   unsaved changes, but since \textsl{Yoshimi} Version 2.3.2 all configuration
   changes are saved as they are made.
\iffalse
\begin{figure}[H]
   \centering
   \includegraphics[scale=0.8]{2.3.0/settings_changed.png}
   \caption[Yoshimi Menu, Exit]{Yoshimi Menu, Exit}
   \label{fig:yoshimi_change_exit}
\end{figure} \fi

\input{yum_menu_instruments}

\input{yum_menu_patch_sets}

\subsection{Menu / Paths}
\label{subsec:menu_paths}

\textsl{Yoshimi} (as installed by Debian Linux) provides a default bank at
   \texttt{/usr/share/yoshimi/banks}.
   To add one's own directory, click on the \textbf{Bank Root Dirs...} entry.
   It brings up the following dialog.

   \begin{enumber}
      \item \textbf{Bank Root Dirs...}.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.75]{2.3.0/roots.png}
   \caption{Bank Root Paths}
   \label{fig:bank_root_paths}
\end{figure}

   This dialog has a number of buttons, some of which will be disabled if no
   directory in the list is selected.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.8]{2.3.0/new_bank_root.png}
   \caption{New Root Directory}
   \label{fig:new_root_directory}
\end{figure}

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

   \itempar{Add root directory...}{Root Paths!add directory}
   Bank Root Paths, Add Root Directory.

   Once selected, one will see that
   \texttt{/usr/share/yoshimi/banks} or
   \texttt{/usr/local/share/yoshimi/banks}
   is marked with an asterisk.  One can select the new root directory via the
   file dialog that appears, and then make it the current root by clicking the
   \textbf{Make current} button.  Then the Banks dialog will show all the banks
   in that directory, one bank per subdirectory (each subdirectory "is" a
   bank).

   \itempar{Remove root directory...}{Root Paths!remove directory}
   Bank Root Paths, Remove Root Directory.
   If a path is selected, then this button is active, and can be used to
   delete the selected path from the "root paths" list. Note that this does
   \textbf{not} delete actual files, just removes the entry from the list.

   \itempar{Make current}{Root Paths!make current}
   Bank Root Paths, Make Current.
   \index{current!root}
   This button marks the currently-selected path as the "current root" path.

   \itempar{Open current}{Root Paths!open current}
   Bank Root Paths, Open Current.
   This button opens the current root path.

   \itempar{Change ID}{Root Paths!change ID}
   Bank Root Paths, Change ID.
   This ID can be used to make the bank selectable via an extended MIDI
   control.

   Values: \texttt{0* to 127}


      \item \textbf{Preset Dirs...}.
         The \textsl{Yoshimi} preset directories are the locations where
         presets can be found.  See below for details.
   \end{enumber}

   The \textsl{Yoshimi} preset directories are the locations where
   presets can be found.  When first installed, the system
   preset directory is one of the following, depending on whether
   \textsl{Yoshimi} was installed via a package manager or via source code:

   \begin{verbatim}
      /usr/share/yoshimi/presets
      /usr/local/share/yoshimi/presets
   \end{verbatim}

   The user can provide additional directories for the presets, up to a
   limit of 128 directories (like roots and banks).
   These directories are useful for containing copies of the system
   presets that one can modify safely, and for providing custom
   presets designed by the user.

   The following items are provided by the preset directory settings:

   \begin{enumber}
      \item \textbf{Preset list}
      \item \textbf{Add preset directory...}
      \item \textbf{Remove preset directory...}
      \item \textbf{Make Current}
      \item \textbf{Close}
   \end{enumber}

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.9]{2.3.0/preset_dirs.png}
   \caption[Preset Dirs Tab]{Yoshimi Preset Dirs Dialog}
   \label{fig:yoshimi_presets_dirs_tab}
\end{figure}

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

   \itempar{Preset list}{Yoshimi Presets!Preset List}
   This interface element contains a list of preset directories.
   By default, the only directory present is the installed preset directory.
   For example, \texttt{/usr/share/yoshimi/presets}.

   \textbf{Tip:}
   \index{tip!preset directory}
   If there is no directory in this dialog, then one must
   add one, otherwise there is no place to store the presets.
   So make this one of the first items specified when first running
   \textsl{Yoshimi}!

   Another example would be this project; let YOSHIMI-DOC be the directory
   where this project is stored.  Then one can add
   \texttt{YOSHIMI-DOC/config/yoshimi/presets} to this list, using the
   button described next.

   \itempar{Add preset directory...}{Yoshimi Presets!Add Directory}
   Use this button and dialog to add a preset directory to the list, for
   easy access.

   Press the \textbf{Add preset directory...} button, revealing the
   following dialog.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.7]{2.3.0/new_preset_dir.png}
   \caption[Add Preset Directory]{Add a Preset Directory}
   \label{fig:presets_add_a_preset_directory}
\end{figure}

   Navigate to the desired directory, select it, and press the \textbf{Ok}
   button.  (There is no need to press the \textbf{Save and Close} button;
   the directory is added as soon as \textsl{OK} is clicked.  However, one
   tends to want to click it anyway, to be sure.)
   \textsl{Important}:  Restart \textsl{Yoshimi} to use the preset directory.

   \itempar{Remove preset directory...}{Yoshimi Presets!Remove Directory}
   Select one of the preset directories in the preset list, then press this
   button to remove the preset directory from the list of preset
   directories.  It is removed immediately, with no need to confirm the
   deletion, click an OK button, or click a Save button.

   \itempar{Make current preset}{Yoshimi Presets!Make Current}
   Make Current.
   Select one of the preset directories in the preset list, then press this
   button to make the preset directory the currently visible preset directory.
   It should be a directory for which one has write permissions.
   By default, it is \texttt{\textasciitilde/.config/yoshimi/presets}.

\subsection{Menu / State}
\label{subsec:menu_state}

   \textsl{Yoshimi} state is saved in files with the extension
   \texttt{.state}.  These files are also XML files.

   \textsl{Yoshimi} "state" will include the system settings, as well as all
   patches. Some of these settings (such as Oscillator Size) can only be
   realised on a reload if loading via the command line at startup.

   \begin{enumber}
      \item \textbf{Load}
      \item \textbf{Save}
      \item \textbf{Save as Default}
      \item \textbf{Recent States...}
   \end{enumber}

   State files were originally stored in the
   user's \texttt{.config/yoshimi/yoshimi.state} file, but
   now \textsl{Yoshimi} offers the user's home directory instead.

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

   \itempar{State Load}{State!Load}
   Provides a way to load a previously-saved \textsl{Yoshimi} state file.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.7]{2.3.0/load_state.png}
   \caption{Yoshimi Menu, State Load}
   \label{fig:yoshimi_menu_state_load}
\end{figure}

   This item is a standard \textsl{Yoshimi} file dialog.

   \itempar{State Save}{State!Save}
   Provides a way to save a new or modified \textsl{Yoshimi} state file.

\begin{figure}[H]
   \centering
   \includegraphics[scale=0.7]{2.3.0/save_state.png}
   \caption{Yoshimi Menu, State Save}
   \label{fig:yoshimi_menu_state_save}
\end{figure}

   This item is a standard \textsl{Yoshimi} file dialog.

   \itempar{Save as Default}{State!Save default}
   This item simply makes the current state the new default state when starting
   \textsl{Yoshimi}.
   This item is effective only if the \textbf{Start With Default State}
   option is checked in \textbf{Yoshimi / Settings}. This item is also
   exceptional as it will \textsl{not} appear in the history list, and so
   will not be offered as a normal load or save. This provides some protection
   against inadvertently overwriting it.

   \itempar{Recent States}{State!Recent}
   This item brings up a list of states to select.
   The Recent States dialog will not come up if there are no states that have
   yet been managed.

%-------------------------------------------------------------------------------
% vim: ts=3 sw=3 et ft=tex
%-------------------------------------------------------------------------------
